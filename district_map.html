<html>

<head>
    <meta charset="utf-8">
    <title>MainMap</title>
</head>
<style>
    div.tooltip {
        color: #222;
        background: #fff;
        border-radius: 3px;
        box-shadow: 0px 0px 2px 0px #a6a6a6;
        padding: .2em;
        text-shadow: #f5f5f5 0 1px 0;
        opacity: 0.9;
        position: absolute;
    }
</style>

<body>
    <div id="map">

    </div>
    <script src="//maps.google.com/maps/api/js?sensor=true"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>

    <script>
        var width = 1000;
        var height = 1000;


        //leaflet map
        // var map = new L.Map("map", { center: [37.8, -96.9], zoom: 4 })
        //     .addLayer(new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"));

        //customize color range
        var lightcolor = d3.rgb(0, 200, 200);    //light blue
        var deepcolor = d3.rgb(0, 50, 200);        //deep blue
        var mycolor = d3.interpolate(lightcolor, deepcolor);        //color range


        //mapping data with color range
        // var linear = d3.scale.linear()
        //     .domain([0, 500])
        //     .range([0, 1]);


        //other way to customize color
        var mycolor2 = d3.scale.linear().domain([1, 1000])
            .interpolate(d3.interpolateHcl)
            .range([d3.rgb("#007AFF"), d3.rgb('#FFF500')]);


        //for tooltip 
        var offsetL = document.getElementById('map').offsetLeft + 10;
        var offsetT = document.getElementById('map').offsetTop + 10;



        var path = d3.geo.path()
            .projection(projection);

        var tooltip = d3.select("#map")
            .append("div")
            .attr("class", "tooltip hidden");




        var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(0,0)");

        var projection = d3.geo.mercator()
            //.center([-0.076132,51.508530])
            .center([-118.243683, 34.052235])
            //.center([-74, 4.5])
            //.center([107, 31])
            .scale(20000)
            .translate([width / 2, height / 2]);

        var path = d3.geo.path()
            .projection(projection);


        var color = d3.scale.category20();

        d3.json("Dataset/la_district_data.json", function (data) {
            d3.json("Dataset/la_district.geo.json", function (error, root) {
                if (error)
                    return console.error(error);
                console.log(root.features);

                var linear = d3.scale.linear()
                    .domain(d3.extent(data, function(it) { return it.totPeople; }))
                    .range([0, 1]);

                //d3.extent(data, function(it) { return it.totPeople; });

                for (var i = 0; i < data.length; i++) {

                    //get data: community name
                    var dataName = data[i].District_Name;
                    //get data: community count
                    var dataValue = data[i].totPeople;


                    //match with geojson
                    for (var j = 0; j < root.features.length; j++) {
                        var geoName = root.features[j].properties.name;
                        if (dataName == geoName) {
                            root.features[j].properties.counts = dataValue;

                        }
                    }
                }

                svg.selectAll("path")
                    .data(root.features)
                    .enter()
                    .append("path")
                    .attr("stroke", "#000")
                    .attr("stroke-width", 1)
                    //.attr("name", function (d) { return d.properties.name; })
                    .attr("fill", function (d) {
                        if (d.properties.counts) {
                            return mycolor(linear(d.properties.counts).toString());
                        } else {
                            return "white";
                        }

                    })
                    .attr("d", path)
                    .on("mouseover", showTooltip)
                    .on("mouseout", function (d) {
                        tooltip.classed("hidden", true);
                        if (d.properties.counts) {
                            d3.select(this)
                                .attr("fill", mycolor(linear(d.properties.counts)).toString());
                        } else {
                            d3.select(this)
                                .attr("fill", "white");
                        }

                    });

            });
        })




        function showTooltip(d, i) {
            label = "Name: " + d.properties.name + "</br>" + "Counts:" + d.properties.counts;
            var mouse = d3.mouse(svg.node())
                .map(function (d) { return parseInt(d); });
            tooltip.classed("hidden", false)
                .attr("style", "left:" + (mouse[0] + offsetL) + "px;top:" + (mouse[1] + offsetT) + "px")
                .html(label);
            d3.select(this).attr("fill", "yellow");
        }



    </script>

</body>

</html>